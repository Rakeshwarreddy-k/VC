"use strict";(self.webpackChunkvirtualclient=self.webpackChunkvirtualclient||[]).push([[8644],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),u=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},s=function(e){var t=u(e.components);return o.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,k=p["".concat(c,".").concat(m)]||p[m]||d[m]||i;return n?o.createElement(k,a(a({ref:t},s),{},{components:n})):o.createElement(k,a({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var u=2;u<i;u++)a[u]=n[u];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},4559:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var o=n(7462),r=(n(7294),n(3905));const i={},a="Building Docker Containers",l={unversionedId:"developing/0061-build-docker-container",id:"developing/0061-build-docker-container",title:"Building Docker Containers",description:"The following sections cover how to build a Docker image that will contain the Virtual Client.",source:"@site/docs/developing/0061-build-docker-container.md",sourceDirName:"developing",slug:"/developing/0061-build-docker-container",permalink:"/VirtualClient/docs/developing/0061-build-docker-container",draft:!1,editUrl:"https://github.com/microsoft/VirtualClient/edit/main/website/docs/developing/0061-build-docker-container.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Workload Development Recommendations",permalink:"/VirtualClient/docs/developing/0060-develop-workload"},next:{title:"Error Handling Recommendations",permalink:"/VirtualClient/docs/developing/0070-error-handling"}},c={},u=[{value:"Installing Docker on your Windows Dev machine",id:"installing-docker-on-your-windows-dev-machine",level:2},{value:"Building VC Container",id:"building-vc-container",level:2},{value:"Command to build",id:"command-to-build",level:3},{value:"Switch between Windows and Linux",id:"switch-between-windows-and-linux",level:3},{value:"Supported Platforms",id:"supported-platforms",level:3},{value:"Run VC Container",id:"run-vc-container",level:2}],s={toc:u};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"building-docker-containers"},"Building Docker Containers"),(0,r.kt)("p",null,"The following sections cover how to build a Docker image that will contain the Virtual Client."),(0,r.kt)("h2",{id:"installing-docker-on-your-windows-dev-machine"},"Installing Docker on your Windows Dev machine"),(0,r.kt)("p",null,"To run Docker on your presumeably Windows Dev Machine, you need to install both Docker and WSL. Reboots might be required."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/editions/community/docker-ce-desktop-windows"},"Docker desktop for Windows")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/windows/wsl/install-win10#manual-installation-steps"},"Install Windows Subsystem for Linux"))),(0,r.kt)("h2",{id:"building-vc-container"},"Building VC Container"),(0,r.kt)("p",null,"VC containers uses ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/_/microsoft-dotnet-runtime/"},"official .NET Runtime docker images")," as base images. Specific tags are used match the OS/Architecture for the container.\nFor example, mcr.microsoft.com/dotnet/runtime:5.0.9-focal-arm64v8 will pull up the Ubuntu20.04-ARM64 image with .NET5.0.9. Please refer to the Official .NET Docker repository page if tags need to be updated in Dockerfile."),(0,r.kt)("h3",{id:"command-to-build"},"Command to build"),(0,r.kt)("p",null,"The command to build docker container is ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/build/"},'"docker build"'),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"IMPORTANT"),': Always tag your docker container using "-t" and ":", "-t test-win-x64:1.0.1.1" will mark "name=test-win-x64" and "tag=1.0.1.1".\nIf tag after column sign is not supplied, it will be assigned a default tag "latest", which could overwrite production image if pushed accidentally.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ docker build -f src\\VirtualClient\\VirtualClient.Packaging\\dockerfiles\\win-x64.dockerfile -t test-win-x64:1.0.1.1 E:\\source\\VirtualClient\n$ docker build -f src\\VirtualClient\\VirtualClient.Packaging\\dockerfiles\\linux-x64.dockerfile -t test-linux-x64:1.0.1.1 E:\\source\\VirtualClient\n")),(0,r.kt)("h3",{id:"switch-between-windows-and-linux"},(0,r.kt)("a",{parentName:"h3",href:"https://docs.microsoft.com/en-us/windows/wsl/install-win10#manual-installation-steps"},"Switch between Windows and Linux")),(0,r.kt)("p",null,"The container can only run as the Host operating system. On your Windows dev machine, Docker runs Linux containers on the WSL backend, and runs Windows containers on your host operating system.\nAs a result, the docker CLI needs to switch mode if you want to test Windows containers and then Linux containers.\nFrom the Docker Desktop menu, you can toggle which daemon (Linux or Windows) the Docker CLI talks to.\nSelect Switch to Windows containers to use Windows containers, or select Switch to Linux containers to use Linux containers (the default)."),(0,r.kt)("h3",{id:"supported-platforms"},"Supported Platforms"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"linux-x64"),(0,r.kt)("li",{parentName:"ul"},"linux-arm64"),(0,r.kt)("li",{parentName:"ul"},"win-x64"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("del",{parentName:"li"},"win-arm64")," (Working to add support)")),(0,r.kt)("p",null,"It is important to know that Container shares the OS with the host, so sometimes the container will not be able to run on your host even though both are running as win-x64.\nWindowsServerCore2022-Container is not able to run on Windows10-Host for example."),(0,r.kt)("h2",{id:"run-vc-container"},"Run VC Container"),(0,r.kt)("p",null,"The command to run docker container is ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/run/"},'"docker run"')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ docker run -d -p 3000:80 test-win-x64:1.0.1.1 C:\\VirtualClient\\VirtualClient.exe <Your VC Command>\n$ docker run -d -p 3000:80 test-linux-x64:1.0.1.1 VirtualClient/VirtualClient <Your VC Command>\n")))}d.isMDXComponent=!0}}]);